import"./index.vue_vue_type_style_index_0_scoped_6aeaa35a_lang-d37e95d6.js";import{d as E,a as m,c as y,h as G,A as R,G as A,_ as k,r as p,H as L,e as v,w as i,b as c,i as x,g as M,F as S,f as D,x as N,u as T}from"./index-e763ca15.js";import"./userInfo-72ab0a42.js";import{b as z}from"./index-33ea4bee.js";import"./mock-c0f25360.js";class U{async getMinAndMaxDate(a){let t,n;const e={minDate:"",maxDate:""};return a.forEach(l=>{t=a.reduce((o,s)=>this.dateFormatDay(o.planStartDate)<this.dateFormatDay(s.planStartDate)?o:s),n=a.reduce((o,s)=>this.dateFormatDay(o.planEndDate)>this.dateFormatDay(s.planEndDate)?o:s),l.children&&l.children.length&&this.getMinAndMaxDate(l.children)}),e.maxDate=n.planEndDate,e.minDate=t.planStartDate,e}tableDataFormat(a,t){const n=this.dateSubtract(t.minDate,t.maxDate);return a.forEach(e=>{e.left=(this.dateSubtract(t.minDate,e.planStartDate)-1)/n*100+"%",e.right=(this.dateSubtract(e.planEndDate,t.maxDate)-1)/n*100+"%",e.children&&e.children.length&&this.tableDataFormat(e.children,t)}),n}async initGanttData(a,t){const n=this.dateFormatDay(a),e=this.dateFormatDay(t),l=[];let o=[];const s=[];let u,r;for(u=n,r=0;u<=e;u++,r++)l[r]=this.dayFormatDate(u),o[r]=this.dayFormatDate(u).slice(0,7);return o=[...new Set(o)],o.forEach(g=>{const h=[];l.forEach(d=>{d.indexOf(g)>-1&&h.push(d.slice(8,10))});const b={year_mounth:g,children:h};s.push(b)}),s}dateFormatDay(a){return new Date(a).getTime()/1e3/60/60/24}dateSubtract(a,t){return this.dateFormatDay(t)-this.dateFormatDay(a)+1}dayFormatDate(a){const t=new Date(a*24*60*60*1e3);let n="yyyy-MM-dd";const e={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(const l in e)new RegExp("("+l+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?e[l]:("00"+e[l]).substr((""+e[l]).length)));return n}}const w=new U,j=E({__name:"GanttBar",props:{progressItem:{type:Object,default:()=>({})}},setup(_){return(a,t)=>(m(),y("div",null,[G("div",{class:R(["caix-1987-progress-bar","caix-1987-gantt-color-"+_.progressItem.statue]),style:A({marginLeft:_.progressItem.left,marginRight:_.progressItem.right})},null,6)]))}}),H=k(j,[["__scopeId","data-v-21650716"]]),O={class:"selectGantt"},q=E({__name:"index",setup(_){const a=p([]),t=p(),n=p([]),e=p(0),l=p("1");p("2"),p("3");const o=async()=>{try{const r=await z();a.value=r.data,t.value=await w.getMinAndMaxDate(a.value),console.log("min_max_data.value",t.value,t.value.minDate,t.value.maxDate),n.value=await w.initGanttData(t.value.minDate,t.value.maxDate),e.value=w.tableDataFormat(a.value,t.value),console.log("ganttEndInitData.value",n.value),console.log("endTableData",a.value)}catch(r){console.log("e",r)}},s=({columnIndex:r})=>r===3?[1,e.value]:[1,1],u=r=>{console.log("val",r)};return L(()=>{console.log(o())}),(r,g)=>{const h=D("el-radio-button"),b=D("el-radio-group"),d=D("el-table-column"),V=D("el-table"),$=D("el-card");return m(),v($,{class:"app-ganttView"},{default:i(()=>[G("div",O,[c(b,{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=f=>l.value=f),size:"small",onChange:u},{default:i(()=>[c(h,{label:"1"},{default:i(()=>[x("日视图")]),_:1}),c(h,{label:"2",disabled:""},{default:i(()=>[x("周视图")]),_:1}),c(h,{label:"3",disabled:""},{default:i(()=>[x("月视图")]),_:1})]),_:1},8,["modelValue"])]),c(V,{data:a.value,border:!0,"span-method":s,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":"",style:{width:"100%","margin-bottom":"20px"}},{default:i(()=>[c(d,{fixed:"",align:"center",width:"160",prop:"name",label:"项目名称"}),c(d,{fixed:"",align:"center",width:"120",prop:"planStartDate",label:"计划开始时间"}),c(d,{fixed:"",align:"center",width:"120",prop:"planEndDate",label:"计划结束时间"}),(m(!0),y(S,null,M(n.value,(f,C)=>(m(),v(d,{label:f.year_mounth,key:C,align:"center"},{default:i(()=>[(m(!0),y(S,null,M(f.children,(F,I)=>(m(),v(d,{key:I,prop:F,label:F,width:"60",align:"center"},N({_:2},[I===0?{name:"default",fn:i(B=>[c(H,{progressItem:B.row},null,8,["progressItem"])]),key:"0"}:void 0]),1032,["prop","label"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["data"])]),_:1})}}}),Y=k(q,[["__scopeId","data-v-3331b13c"]]),J={class:"app-content"},Z=E({__name:"table-two-page",setup(_){return(a,t)=>(m(),y("div",J,[c(T(Y))]))}});export{Z as default};
